<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Refit e-Invoice System</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<style>
body { font-family: Arial; background:#f4f4f4; padding:20px; }
.invoice { background:#fff; padding:25px; max-width:950px; margin:auto; border:1px solid #000; }
h2 { text-align:right; margin:0; }
input, textarea { width:100%; border:1px solid #000; padding:5px; font-size:13px; }
textarea { resize:none; }
.header { display:flex; justify-content:space-between; margin-bottom:15px; }
.box { width:48%; font-size:13px; }
label { font-weight:bold; font-size:12px; display:block; margin-top:4px; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
table, th, td { border:1px solid #000; }
th, td { padding:6px; font-size:13px; }
.right { text-align:right; }
button { border:1px solid #000; background:#eee; color:#000; padding:6px 10px; margin:4px 2px; cursor:pointer; }
.signature { margin-top:35px; display:flex; justify-content:space-between; }
.sig-box { width:45%; border-top:1px dotted #000; padding-top:5px; text-align:center; font-size:13px; }
#logo { max-height:70px; }

@media print {
  .no-print { display:none !important; }
}
</style>
</head>

<body>

<!-- CONTROL PANEL -->
<div class="no-print">
<button onclick="setDoc('INVOICE')">Invoice</button>
<button onclick="setDoc('QUOTATION')">Quotation</button>
<button onclick="setDoc('DELIVERY ORDER')">DO</button>
<button onclick="setDoc('RECEIPT')">Receipt</button>
<button onclick="window.print()">Print / Preview</button>
<button onclick="generatePDF()">Generate PDF</button>
<br><br>
<label>Upload Logo</label>
<input type="file" onchange="loadLogo(event)">
<br><br>
<label>Upload Buyer Signature</label>
<input type="file" onchange="loadBuyerSign(event)">
<label>Upload Seller Signature</label>
<input type="file" onchange="loadSellerSign(event)">
</div>

<div class="invoice" id="invoice">

<img id="logo">

<h2 id="docTitle">INVOICE</h2>

<!-- HEADER -->
<div class="header">
<div class="box">
<label>Seller Name</label>
<input value="Refit Maintenance Services">

<label>Business Category</label>
<input value="Maintenance & Interior Services">

<label>Business Type</label>
<input value="Sole Proprietorship">

<label>Reg No</label>
<input value="201803348973">

<label>TIN</label>
<input value="OG 10451781060">

<label>Address</label>
<textarea rows="3">C-08-34, Centum @ Oasis Corporate Park, Oasis Damansara, No.2 Jalan PJU 1A/2, Ara Damansara, 47301 Petaling Jaya, Selangor Darul Ehsan, West Malaysia.</textarea>

<label>Bank</label>
<input value="RHB Bank">

<label>Account No</label>
<input value="2126 1100 0235 58">
</div>

<div class="box">
<label>Buyer Name</label>
<input>

<label>Business Category</label>
<input>

<label>Buyer TIN</label>
<input>

<label>Buyer Reg No</label>
<input>

<label>Buyer Address</label>
<textarea rows="3"></textarea>

<label>Contact</label>
<input>

<label>Email</label>
<input>
</div>
</div>

<!-- META -->
<table>
<tr>
<td>Document No</td>
<td><input id="docNo" readonly></td>
<td>Date</td>
<td><input type="date"></td>
</tr>
<tr>
<td>UUID</td>
<td colspan="3"><input id="uuid" readonly></td>
</tr>
</table>

<!-- ITEMS -->
<table id="itemTable">
<tr>
<th>Description</th>
<th>Qty</th>
<th>Unit Price</th>
<th>Amount</th>
<th class="no-print">‚ùå</th>
</tr>
</table>

<button class="no-print" onclick="addRow()">Add Item</button>

<!-- TOTAL -->
<table>
<tr>
<td colspan="3" class="right"><b>Total</b></td>
<td id="grandTotal">0.00</td>
<td class="no-print"></td>
</tr>
</table>

<label>Amount in Words</label>
<input id="words">

<div id="qrcode" style="margin-top:15px;"></div>

<!-- SIGNATURE -->
<div class="signature">
<div class="sig-box">
<img id="buyerSign" style="max-height:60px"><br>
Buyer Signature
</div>

<div class="sig-box">
<img id="sellerSign" style="max-height:60px"><br>
<b>Refit Maintenance Services</b>
</div>
</div>

</div>

<script>
document.querySelector('input[type=date]').value = new Date().toISOString().slice(0,10);
document.getElementById("uuid").value = crypto.randomUUID();

/* AUTO RUNNING NUMBER */
function getYear(){ return new Date().getFullYear(); }

function generateDocNo(prefix){
  const year = getYear();
  const key = prefix + "-" + year;
  let run = localStorage.getItem(key);
  run = run ? parseInt(run) + 1 : 1;
  localStorage.setItem(key, run);
  return `${prefix}-${year}-${String(run).padStart(3,'0')}`;
}

function setDoc(type){
  const map = {
    "INVOICE":"INV",
    "QUOTATION":"QTN",
    "DELIVERY ORDER":"DO",
    "RECEIPT":"RCP"
  };
  document.getElementById("docTitle").innerText = type;
  document.getElementById("docNo").value = generateDocNo(map[type]);
}

/* ITEMS */
function addRow(){
let t=document.getElementById("itemTable");
let r=t.insertRow();
r.innerHTML=`<td contenteditable></td>
<td contenteditable oninput="calc()"></td>
<td contenteditable oninput="calc()"></td>
<td class="right">0.00</td>
<td class="no-print"><button onclick="this.parentElement.parentElement.remove();calc()">X</button></td>`;
}
addRow();

function calc(){
let total=0;
document.querySelectorAll("#itemTable tr").forEach((r,i)=>{
if(i>0){
let q=parseFloat(r.cells[1].innerText)||0;
let p=parseFloat(r.cells[2].innerText)||0;
let a=q*p;
r.cells[3].innerText=a.toFixed(2);
total+=a;
}
});
document.getElementById("grandTotal").innerText=total.toFixed(2);
document.getElementById("words").value=total.toFixed(2)+" RINGGIT MALAYSIA";
generateQR();
}

function generateQR(){
document.getElementById("qrcode").innerHTML="";
new QRCode(document.getElementById("qrcode"), {
text: document.getElementById("uuid").value,
width:90,height:90
});
}

function generatePDF(){
html2pdf().from(document.getElementById("invoice")).save();
}

function loadLogo(e){
let r=new FileReader();
r.onload=()=>document.getElementById("logo").src=r.result;
r.readAsDataURL(e.target.files[0]);
}
function loadBuyerSign(e){
let r=new FileReader();
r.onload=()=>document.getElementById("buyerSign").src=r.result;
r.readAsDataURL(e.target.files[0]);
}
function loadSellerSign(e){
let r=new FileReader();
r.onload=()=>document.getElementById("sellerSign").src=r.result;
r.readAsDataURL(e.target.files[0]);
}

/* DEFAULT LOAD */
window.onload = ()=>setDoc("INVOICE");
</script>

</body>
</html>
